<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link href='https://fonts.googleapis.com/css?family=Inconsolata:400,700&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
</head>
<style>

	#result span{
		background: pink;
		border-radius: 10px;
		font-size: 34px;
	}
	.line{
		border:1px solid #12aaee;
	}
	#editor{
		opacity: 0;
	}
	html{
		font-family: 'Inconsolata', monospace;
/*		-moz-user-select: none;
		-khtml-user-select: none;
		user-select: none;   
		    -webkit-user-select: none;
    -ms-user-select: none;*/
	}
</style>
<body>
	<div id="result" class="editor">
		
	</div>
	<textarea name="" id="editor" cols="30" rows="10">
	</textarea>
	<div class="console" style="position:fixed; top:0; right:0; width:200px; height: 50px;"></div>

<div class="someeditor">
	
</div>

<div class="someeditor">
	
</div>

<div class="someeditor_another">
	
</div>
</body>
</html>
<script>
'use strict'
	///////////////////////////////////
	/**         MAIN CLASS          **/
	///////////////////////////////////
/**
	* @name Editor
	* @version 1.0.0
	* @author Ivan Kaduk
	* @copyright Ivan Kaduk 2016.
	* @class
	* @augments Observable
	* @classdesc this class is creating editor object
	* @example var spoiler = new Spoiler('spoiler','opened', 1);
	* @param {String} className - class of div wich containe spoiler child elements.
	*/
	var Editor = (function()
	{
		// constructor
		function Editor(name, options){
			if(name != undefined)
			{
				// innitialization global variables for 
			/**
				* @public
				*/	
				this.editor_name = name;
			/**
				* @public
				*/	
				this.container= new Array();
			/**
				* @public
				*/	
				this.work_space = new Array();
			/**
				* @public
				*/	
				this.symbol_buffer = new Array();
			/**
				* @public
				*/	
				this.console = new Array();
			/**
				* @public
				*/
				this.line = new Array();
			/**
				* @public
				*/
				this.current_line = new Array();

				// inheritation of observable
				if(Observable != undefined)
				{
					Observable.apply(this, arguments);
					this.subscribe(Key_Observer);
				}


				// unic code for each editor by this class 
				for (var i = 0; i < document.getElementsByClassName(this.editor_name).length; i++) 
				{

					// main container
					this.container[i] = document.getElementsByClassName(this.editor_name)[i];
					this.container[i].style.position = 'relative';

					// textare tag for given symbols 
					this.symbol_buffer[i] = document.createElement('textarea');
					this.symbol_buffer[i].className = 'symbol_buffer';
					this.symbol_buffer[i].cols = '1';
					this.symbol_buffer[i].rows = '1';
					this.symbol_buffer[i].style.opacity = '0';
					this.container[i].appendChild(this.symbol_buffer[i]);

					// working space 
					this.work_space[i] = document.createElement('div');
					this.work_space[i].className = 'result';
					this.work_space[i].style.border = '1px solid #000';
					this.work_space[i].style.height = '500px';
					function disableselect(e) {return false}
					this.work_space[i].onselectstart = function (){return false};
					this.work_space[i].onmousedown = disableselect;
					this.container[i].appendChild(this.work_space[i]);

					// initializing first line
					this.line[i] = new Array();
					this.current_line[i] = 1;
					this.line[i][this.current_line[i]] = document.createElement('div');
					this.line[i][this.current_line[i]].className = 'line';
					this.line[i][this.current_line[i]].setAttribute('line_number', this.current_line[i]);
					this.work_space[i].appendChild(this.line[i][this.current_line[i]]);

					// console in right conor of component
					if(options.console == true)
					{
						this.console[i] = document.createElement('div');
						this.console[i].className = 'console';
						this.console[i].style.border = '1px solid #000';
						this.console[i].style.position = 'absolute';
						this.console[i].style.top = '0px';
						this.console[i].style.right = '0px';
						this.console[i].style.width = '200px';
						this.console[i].style.height = '50px';
						this.container[i].appendChild(this.console[i]);
					}

				/**
					* @event work_space#onclick
					*/
					this.work_space[i].object = this;
					this.work_space[i].index = i;
					this.work_space[i].onclick = function()
					{
						this.object.symbol_buffer[this.index].focus();
						//console.log(window.getSelection());
					}

				/**
					* @event symbol_buffer#onclick
					* @param {object} e - event wich will contain key code
					*/
					this.symbol_buffer[i].object = this;
					this.symbol_buffer[i].index = i;
					this.symbol_buffer[i].key_scope = Key_Scope.getInstance();
					this.symbol_buffer[i].onkeydown = function(e)
					{
						// observer innitialithation 
						if(Observable != undefined)
						{
							this.object.publish(this.object, this.key_scope, this.index, e, 'pressed');
						}
					};
					this.symbol_buffer[i].onkeyup = function(e)
					{
						if(Observable != undefined)
						{
							this.object.publish(this.object, this.key_scope, this.index, e, 'relised');
						}
					};

				};
			}
			else
			{
				console.log('sorry but you have not add any name to editors name field');
			}
		}

		return Editor;

	})()

	///////////////////////////////////
	/**         BUILDER             **/
	///////////////////////////////////
/**
	* @name Char_Class_Generator
	* @author Ivan Kaduk
	* @copyright Ivan Kaduk 2016.
	* @class
	* @classdesc this class is returning string for elements class
	* @example class_generator
						.setPrefix('wet-')
						.mainClass(data.symbol_buffer[index].value)
						.space()
						.subClass(data.symbol_buffer[index].value)
						.generate() 
	*/
	var Char_Class_Generator = function()
	{
		var char = '';
		var code = '';
		var result_class = '';
		var prefix = '';

	/**
		* @public
		* @function
		* @name mainClass
		* @description adding main class
		* @param {String} user_char - char from cher buffer 
		*/
		function mainClass(user_char)
		{

			char = user_char;
			// converting char type variable to dec code
			code = char.charCodeAt(0);

			// adding class to result variable
			if((code <= 47)||((code >= 58)
			&&(code <= 64))||((code >= 91)
			&&(code <= 96))||((code >= 122)
			&&(code <= 126)))
			{
				result_class = prefix + 'signifier';
			}
			else if((code >= 48)&&(code <= 57))
			{
				result_class = prefix + 'numeral';
			}
			else if(((code >= 65)&&(code <= 90))
						||((code >= 97)&&(code <= 122)))
			{
				result_class = prefix + 'character';
			}
			return this;
		}

	/**
		* @public
		* @function
		* @name subClass
		* @description adding subclass to main 
		* @param {String} user_char - char from cher buffer 
		*/
		function subClass(user_char)
		{
			char = user_char;
			code = char.charCodeAt(0);

			// signifires and uppercase code map 
			var codes = [
				{'start_code':32, 'end_code':32, 'desc':'space'}, //
				{'start_code':33, 'end_code':33, 'desc':'exclamation'}, // !
				{'start_code':34, 'end_code':34, 'desc':'quotation '}, // "
				{'start_code':35, 'end_code':35, 'desc':'hash'}, // #
				{'start_code':36, 'end_code':36, 'desc':'dollar'}, // $
				{'start_code':37, 'end_code':37, 'desc':'percent'}, // %
				{'start_code':38, 'end_code':38, 'desc':'ampersand'}, // &
				{'start_code':39, 'end_code':39, 'desc':'apostrophe'}, // '
				{'start_code':40, 'end_code':40, 'desc':'left_parenthesis'}, // (
				{'start_code':41, 'end_code':41, 'desc':'right_parenthesis'}, // )
				{'start_code':42, 'end_code':42, 'desc':'asterix'}, // *
				{'start_code':43, 'end_code':43, 'desc':'plus'}, // +
				{'start_code':44, 'end_code':44, 'desc':'comma'}, // ,
				{'start_code':45, 'end_code':45, 'desc':'hyphen'}, // - 
				{'start_code':46, 'end_code':46, 'desc':'period'}, // .
				{'start_code':47, 'end_code':47, 'desc':'slash'}, // /
				{'start_code':58, 'end_code':58, 'desc':'colon'}, // :
				{'start_code':59, 'end_code':59, 'desc':'semicolon'}, // ;
				{'start_code':60, 'end_code':60, 'desc':'less_than'}, // <
				{'start_code':61, 'end_code':61, 'desc':'equals'}, // =
				{'start_code':62, 'end_code':62, 'desc':'greater_than'}, // >
				{'start_code':63, 'end_code':63, 'desc':'question'}, // ?
				{'start_code':64, 'end_code':64, 'desc':'at'}, // @
				{'start_code':65, 'end_code':90, 'desc':'uppercase'}, // upp
				{'start_code':91, 'end_code':91, 'desc':'left_square_vrecket'}, // [
				{'start_code':92, 'end_code':92, 'desc':'backslash'}, // \
				{'start_code':93, 'end_code':93, 'desc':'right_square_vrecket'}, // ]
				{'start_code':94, 'end_code':94, 'desc':'caret'}, // ^
				{'start_code':95, 'end_code':95, 'desc':'underscore'}, // _
				{'start_code':96, 'end_code':96, 'desc':'grave_accent'}, // `
				{'start_code':123, 'end_code':123, 'desc':'left_curly_brace'}, // {
				{'start_code':124, 'end_code':124, 'desc':'vertical_bar'}, // |
				{'start_code':125, 'end_code':125, 'desc':'left_curly_brace'}, // }
				{'start_code':126, 'end_code':126, 'desc':'tilda'}, // ~ 
			];
			// adding subclass to result class 
			for (var i = 0; i < codes.length; i++) {
				if((code == codes[i].start_code))
				{
					result_class += prefix + codes[i].desc;
				}
				else if(((code >= codes[i].start_code)&&(code <= codes[i].start_code)))
				{
					result_class += prefix + codes[i].desc;
				}
				else
				{
					result_class += '';
				}
			};
			return this;
		}

	/**
		* @public
		* @function
		* @name setPrefix
		* @description setting prefix, which will be adding to every class
		* @param {String} user_prefix - prefix for class
		*/
		function setPrefix(user_prefix)
		{
			prefix = user_prefix || "";
			return this;
		}

	/**
		* @public
		* @function
		* @name space
		* @description addpace between classes
		*/
		function space()
		{
			result_class += ' ';
			return this;
		}

	/**
		* @public
		* @function
		* @name generate
		* @description builder function
		*/
		function generate()
		{
			return result_class;
		}

		return{
			mainClass: mainClass,
			subClass: subClass,
			generate: generate,
			setPrefix: setPrefix,
			space: space
		}
	}
	
	///////////////////////////////////
	/**         OBSERVABLE          **/
	///////////////////////////////////

/**
	* @name Observable
	* @class
	* @classdesc standart subject for obsrver 
	* @example this.subscribe({some observer});
	*/
	var Observable = function()
	{

		this.subscribers = new Array();

	/**
		* @public
		* @function
		* @name subscribe
		* @description for subscribing observers
		* @param {Object} observer - object wich containe observer instans
		*/
		this.subscribe = function(observer)
		{
			this.subscribers.push(observer);
		}

	/**
		* @public
		* @function
		* @name unsubscribe
		* @description for unsubscribing observers
		* @param {Object} observer - object wich containe observer instans
		*/
		this.unsubscribe = function(observer)
		{
			for (var i = 0; i < this.subscribers.length; i++) 
			{
				if (this.subscribers[i] === observer) 
				{
					this.subscribers[i].splice(i, 1);
					return;
				};
			};
		}

	/**
		* @public
		* @function
		* @name publish
		* @description calling observers constructors
		* @param {Object} data - some objects collection to do some actions with
		* @param {int} counter - index of sub object in data collection
		*/
		this.publish = function(data, scope, index, event, condition)
		{
			for (var i = 0; i < this.subscribers.length; i++) {
				this.subscribers[i](data, scope, index, event, condition);
			};
		}

	}

	///////////////////////////////////
	/**         OBSERVERS           **/
	///////////////////////////////////

	var Key_Observer = function(data, scope, index, event, condition)
	{	
		
		var class_generator = new Char_Class_Generator('wet-');

		if(scope.getKeyMap() == ['17','68']){

		}

		// if that key pressed on new line
		if(data.line[index][data.current_line[index]].innerHTML == '')
		{
			// adding starting teg for a line 
			data.line[index][data.current_line[index]].innerHTML = data.line[index][data.current_line[index]].innerHTML 
																														+ '<span class="wet-line-start">'
																														+ ' ' 
																														+ '</span>';
		}
		// if pressed key is not null 
		if(data.symbol_buffer[index].value != '')
		{
			// adding character with a span tag and special class
			data.line[index][data.current_line[index]].innerHTML = data.line[index][data.current_line[index]].innerHTML 
																														+ '<span class="' 
																														+ class_generator
																															.setPrefix('wet-')
																															.mainClass(data.symbol_buffer[index].value)
																															.space()
																															.subClass(data.symbol_buffer[index].value)
																															.generate() 
																														+ '">' 
																														+ data.symbol_buffer[index].value 
																														+ '</span>';
			// clearing buffer
			data.symbol_buffer[index].value = '';
		}
		// enter emulation, using adding new line
		if(scope.getKeyMap() == 13 )
		{
			data.current_line[index]++;
			console.log(data.current_line[index])
			data.line[index][data.current_line[index]] = document.createElement('div');
			data.line[index][data.current_line[index]].className = 'line';
			data.line[index][data.current_line[index]].setAttribute('line_number', data.current_line[index]);
			data.work_space[index].appendChild(data.line[index][data.current_line[index]]);
		}
	
		// if key is pressed or relissed add event to singleton
		if(condition == 'pressed')
		{
			scope.keyDown(event);
		}
		else if(condition == 'relised')
		{
			scope.keyUp(event);
		}		

		// adding pressed keys combinations to console
		if(data.console[index] != undefined)
		{
			data.console[index].innerHTML = (scope.getKeyMap());
		}
	}


	///////////////////////////////////
	/**         SINGELTON           **/
	///////////////////////////////////

/**
	* @name Key_Scope
	* @version 1.0.0
	* @author Ivan Kaduk
	* @copyright Ivan Kaduk 2016.
	* @class
	* @classdesc it singelton which contain current key combinations
	* @example var key_scope = Key_Scope.getInstance();
	*/
	var Key_Scope = (function () {

    var instance;

    function createInstance() 
    {
    /**
    	* @private
    	*/
    	var key_map = new Array();

    /**
    	* @private
    	*/
    	var key_flag = false;

		/**
			* @private
			* @function
			* @name addKeyToMap
			* @description adding key code to key map
			* @param {int} key - key code frome key event
			*/
		  function addKeyToMap(key) {
		    if(key_map.length == 0)
		    {
		     	key_map.push(key);
		    }
		    else
		    {
			    for (var i = 0; i <= key_map.length; i++) 
			     {
			      if(key_map[i] == key) 
			      {
			        key_flag = true;
			      }
			    }
			    if(key_flag == false)
			    {
			     	key_map.push(key);
			    }
			    key_flag = false;
		    }
		  }

		/**
			* @private
			* @function
			* @name removeKeyFromMap
			* @description removing key code to key map
			* @param {int} key - key code frome key event
			*/
		  function removeKeyFromMap(key) {
		    for (var i = 0; i <= key_map.length; i++) 
		    {
		      if (key_map[i] == key) 
		      {
		        key_map.splice(i, 1);
		      }
		    }
		  }

		/**
			* @public
			* @function
			* @name keyDown
			* @description catching code frome event and adding it to key map, on some action 
			* @param {object} e - event which contain code of pressed button
			*/
		  function keyDown(e)  {
		    var key_num;
		    if (window.event) // IE   
		    { 
		    	e.preventDefault(); e.stopPropagation();      
		      key_num = e.keyCode;
		    } 
		    else if (e.which) // Netscape/Firefox/Opera
		    {           
		    	e.preventDefault(); e.stopPropagation();
		      key_num = e.which;
		    }
		    addKeyToMap(key_num);
		  }

		/**
			* @public
			* @function
			* @name keyUp
			* @description catching code frome event and removing it to key map, on some action 
			* @param {object} e - event which contain code of pressed button
			*/
		  function keyUp(e) {
		    var key_num;
		    if (window.event) // IE  
		    {         
		    	e.preventDefault(); e.stopPropagation();
		      key_num = e.keyCode;
		    } 
		    else if (e.which) // Netscape/Firefox/Opera 
		    {          
		    	e.preventDefault(); e.stopPropagation();
		      key_num = e.which;
		    }
		    removeKeyFromMap(key_num);
		  }

		/**
			* @public
			* @function
			* @name keyUp
			* @description return key map 
			* @return {Array} - key map content
			*/
		  function getKeyMap()
		  {
		  	return key_map.sort();
		  }

		/**
			* @public
			* @function
			* @name keyUp
			* @description refreshing key map
			*/
		  function clearKeyMap()
		  {
		  	key_map = [];
		  }
 		    
		  return {
		    keyDown : keyDown,
		    keyUp : keyUp,
		    getKeyMap: getKeyMap,
		    clearKeyMap: clearKeyMap
		  };

    }

 		return {
        getInstance: function () {
            if (!instance) {
                instance = createInstance();
            }
            return instance;
        }
    };
	})();

	///////////////////////////////////
	/**         MODULE 						  **/
	///////////////////////////////////	

	var Module = (function()
	{
		function Module(object, index )
		{

		}

		return Module;
	})()


	///////////////////////////////////
	/**         MAIN SCRIPT         **/
	///////////////////////////////////

	var first = new Editor('someeditor', {
		console:true
	});

	var second = new Editor('someeditor_another', {
		console:false
	});

</script>